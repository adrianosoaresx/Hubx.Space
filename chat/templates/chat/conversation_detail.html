{% extends "chat/base_chat.html" %}
{% load i18n widget_tweaks %}

{% block title %}{{ conversation.titulo }}{% endblock %}

{% block chat_content %}
<main class="max-w-4xl mx-auto p-4">
  <header class="mb-4">
    <h2 class="text-lg font-semibold">{{ conversation.titulo }}</h2>
    <p class="text-sm text-gray-500">
      {% trans "Participantes" %}:
      {% for p in conversation.participants.all %}
        {{ p.user.username }}{% if not forloop.last %}, {% endif %}
      {% endfor %}
    </p>
  </header>

  <div id="messages" class="overflow-y-auto h-[calc(100vh-15rem)] space-y-4 mb-4">
    {% for m in mensagens %}
      {% include "chat/partials/message.html" with m=m %}
    {% empty %}
      <p class="text-neutral-500">{% trans "Nenhuma mensagem." %}</p>
    {% endfor %}
  </div>

  <form
    method="post"
    enctype="multipart/form-data"
    class="flex gap-2"
    hx-post="."
    hx-target="#messages"
    hx-swap="beforeend"
    hx-on:afterSwap="this.reset()"
  >
    {% csrf_token %}
    {{ form.tipo }}
    {{ form.arquivo }}
    {{ form.conteudo|add_class:"flex-1 border rounded p-2" }}
    <button class="bg-primary text-white px-4 py-2 rounded hover:bg-primary/90" type="submit">{% trans "Enviar" %}</button>
  </form>
</main>
{% endblock %}
