{% if partial %}
  {% for comentario in comentarios %}
  <article class="p-4 border-b border-neutral-200" id="coment-{{ comentario.id }}">
    <header class="mb-2 flex items-center justify-between">
      <div class="text-sm text-neutral-700">
        {{ comentario.autor.get_full_name|default:comentario.autor.username }} - {{ comentario.created|date:"d/m/Y H:i" }}
      </div>
      {% if user == comentario.autor or user.get_tipo_usuario in ['admin','coordenador','root'] %}
        <form method="post" hx-delete="{% url 'discussao:delete_comment' comentario.id %}" hx-target="#coment-{{ comentario.id }}" hx-swap="delete">
          {% csrf_token %}
          <button type="submit" class="text-red-600 text-xs">{% trans "Remover" %}</button>
        </form>
      {% endif %}
    </header>
    <div class="prose max-w-none text-sm">{{ comentario.conteudo|linebreaks }}</div>
  </article>
  {% endfor %}
{% else %}
{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ topico.titulo }} | HubX{% endblock %}
{% block content %}
<article class="max-w-3xl mx-auto px-4 py-10">
  <header class="mb-6 border-b border-neutral-200 pb-4">
    <h1 class="text-2xl font-bold text-neutral-900 mb-2">{{ topico.titulo }}</h1>
    <p class="text-sm text-neutral-600">{% trans "Por" %} {{ topico.autor.get_full_name|default:topico.autor.username }} Â· {{ topico.created|date:"d/m/Y H:i" }}</p>
    <div class="flex items-center space-x-1 mt-2">
      <button hx-post="{% url 'discussao:interacao' content_type_id topico.id 'up' %}" hx-swap="none" hx-on:afterRequest="document.getElementById('topic-score').innerText = event.detail.xhr.responseJSON.score">&#9650;</button>
      <span id="topic-score">{{ topico.score }}</span>
      <button hx-post="{% url 'discussao:interacao' content_type_id topico.id 'down' %}" hx-swap="none" hx-on:afterRequest="document.getElementById('topic-score').innerText = event.detail.xhr.responseJSON.score">&#9660;</button>
    </div>
  </header>
  <div class="prose max-w-none mb-10">{{ topico.conteudo|linebreaks }}</div>
  <section aria-labelledby="comentarios" class="space-y-4">
    <h2 id="comentarios" class="text-xl font-semibold">{% trans "Coment\u00e1rios" %}</h2>
    <div id="lista-comentarios">
      {% include 'discussao/topico_detail.html' with partial=True only %}
    </div>
    {% if comentarios.has_previous or comentarios.has_next %}
    <div class="flex justify-center gap-3 text-sm">
      {% if comentarios.has_previous %}
        <a hx-get="?page={{ comentarios.previous_page_number }}" hx-target="#lista-comentarios" class="px-3 py-1 border rounded-xl">{% trans "Anterior" %}</a>
      {% endif %}
      <span class="px-3 py-1">{% trans "P\u00e1gina" %} {{ comentarios.number }}</span>
      {% if comentarios.has_next %}
        <a hx-get="?page={{ comentarios.next_page_number }}" hx-target="#lista-comentarios" class="px-3 py-1 border rounded-xl">{% trans "Pr\u00f3xima" %}</a>
      {% endif %}
    </div>
    {% endif %}
    <form method="post" hx-post="{% url 'discussao:resposta_criar' topico.categoria.slug topico.slug %}" hx-target="#lista-comentarios" hx-swap="beforeend" class="space-y-4 mt-6">
      {% csrf_token %}
      <label for="id_conteudo" class="block text-sm font-medium text-neutral-700">{% trans "Comentar" %}</label>
      <textarea name="conteudo" required class="form-textarea"></textarea>
      <button type="submit" class="bg-primary-600 hover:bg-primary-700 text-white font-semibold py-2 px-4 rounded-xl">{% trans "Comentar" %}</button>
    </form>
  </section>
</article>
{% endblock %}
{% endif %}
