{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ object.nome }}{% endblock %}

{% block content %}
<section class="max-w-3xl mx-auto py-8">
  {% if object.cover %}
  <img src="{{ object.cover.url }}" class="w-full h-48 object-cover rounded" />
  {% endif %}
  <div class="flex items-center gap-4 mt-4">
    {% if object.avatar %}<img src="{{ object.avatar.url }}" class="w-16 h-16 rounded-full" />{% endif %}
    <div>
      <h1 class="text-2xl font-bold">{{ object.nome }}</h1>
      <p class="text-sm text-gray-500">{{ object.slug }}</p>
    </div>
  </div>

  <h2 class="mt-6 font-semibold">{% trans 'Membros' %}</h2>
  <ul>
    {% for part in membros_aprovados %}
    <li>{{ part.user.get_full_name|default:part.user.username }}{% if part.is_coordenador %} - {% trans 'Coordenador' %}{% endif %}
      {% if request.user.user_type == 'admin' or request.user.user_type == 'coordenador' %}
      <form method="post" action="{% url 'nucleos:membro_role' object.pk part.pk %}" class="inline">{% csrf_token %}
        <input type="hidden" name="is_coordenador" value="{% if part.is_coordenador %}False{% else %}True{% endif %}">
        <button class="text-sm text-blue-600">{% if part.is_coordenador %}{% trans 'Rebaixar' %}{% else %}{% trans 'Promover' %}{% endif %}</button>
      </form>
      <form method="post" action="{% url 'nucleos:membro_remover' object.pk part.pk %}" class="inline">{% csrf_token %}
        <button class="text-sm text-red-600">{% trans 'Remover' %}</button>
      </form>
      {% endif %}
    </li>
    {% empty %}
    <li>{% trans 'Sem membros.' %}</li>
    {% endfor %}
  </ul>

  {% if membros_pendentes %}
  <h2 class="mt-6 font-semibold">{% trans 'Pendentes' %}</h2>
  <ul>
    {% for part in membros_pendentes %}
    <li>{{ part.user.get_full_name|default:part.user.username }}
      <form method="post" action="{% url 'nucleos:participacao_decidir' object.pk part.pk %}" class="inline">{% csrf_token %}
        <input type="hidden" name="acao" value="approve"><button class="text-sm text-green-600">{% trans 'Aprovar' %}</button>
      </form>
      <form method="post" action="{% url 'nucleos:participacao_decidir' object.pk part.pk %}" class="inline">{% csrf_token %}
        <input type="hidden" name="acao" value="reject"><button class="text-sm text-red-600">{% trans 'Recusar' %}</button>
      </form>
    </li>
    {% endfor %}
  </ul>
  {% endif %}

  <div class="mt-6">
    <a href="{% url 'nucleos:exportar_membros' object.pk %}" class="text-blue-600">{% trans 'Exportar membros (CSV)' %}</a>
    {% if request.user.user_type in ('admin','coordenador','root') %}
    <form method="post" action="{% url 'nucleos:toggle_active' object.pk %}" class="inline">{% csrf_token %}
      <button class="ml-2 text-orange-600">{% if object.inativa %}{% trans 'Reativar' %}{% else %}{% trans 'Inativar' %}{% endif %}</button>
    </form>
    {% endif %}
  </div>

  {% if request.user.user_type != 'admin' and request.user.user_type != 'coordenador' %}
  <form method="post" action="{% url 'nucleos:participacao_solicitar' object.pk %}" class="mt-4">{% csrf_token %}
    <button class="px-4 py-2 bg-blue-600 text-white rounded">{% trans 'Solicitar participação' %}</button>
  </form>
  {% endif %}
</section>
{% endblock %}
