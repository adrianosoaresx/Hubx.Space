{% extends 'base.html' %}
{% block title %}Editar Núcleo | Hubx{% endblock %}

{% block content %}
<section class="max-w-2xl mx-auto px-4 py-10">
  <div class="mb-6 flex items-center gap-4">
    <a href="{% url 'nucleos:list' %}" class="inline-flex items-center rounded-xl border border-neutral-300 px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
      <svg class="mr-2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15,18 9,12 15,6"/>
      </svg>
      Voltar
    </a>
    <h1 class="text-2xl font-bold text-neutral-900">Editar Núcleo</h1>
  </div>

  <form method="post" enctype="multipart/form-data" class="space-y-6 rounded-2xl border border-neutral-200 bg-white p-6 shadow-sm">
    {% csrf_token %}
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label for="{{ form.organizacao.id_for_label }}" class="block text-sm font-medium text-neutral-700">{{ form.organizacao.label }}</label>
        {{ form.organizacao|add_class:"form-select" }}
        {% if form.organizacao.errors %}<p class="mt-1 text-xs text-red-500">{{ form.organizacao.errors }}</p>{% endif %}
      </div>
      <div>
        <label for="{{ form.nome.id_for_label }}" class="block text-sm font-medium text-neutral-700">{{ form.nome.label }}</label>
        {{ form.nome|add_class:"form-input" }}
        {% if form.nome.errors %}<p class="mt-1 text-xs text-red-500">{{ form.nome.errors }}</p>{% endif %}
      </div>
    </div>
    <div>
      <label for="{{ form.descricao.id_for_label }}" class="block text-sm font-medium text-neutral-700">{{ form.descricao.label }}</label>
      {{ form.descricao|add_class:"form-textarea" }}
      {% if form.descricao.errors %}<p class="mt-1 text-xs text-red-500">{{ form.descricao.errors }}</p>{% endif %}
    </div>
    <div>
      <label for="{{ form.avatar.id_for_label }}" class="block text-sm font-medium text-neutral-700">{{ form.avatar.label }}</label>
      <div class="form-file">
        {{ form.avatar|add_class:"form-file-input" }}
        <label for="{{ form.avatar.id_for_label }}" class="form-file-label">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21,15 16,10 5,21"/>
          </svg>
          <div>
            <p class="font-medium">Clique para alterar o avatar</p>
            <p class="text-sm text-neutral-500">PNG, JPG até 2MB</p>
          </div>
        </label>
      </div>
      {% if form.avatar.errors %}<p class="mt-1 text-xs text-red-500">{{ form.avatar.errors }}</p>{% endif %}
    </div>
    <div>
      <label for="{{ form.membros.id_for_label }}" class="block text-sm font-medium text-neutral-700">{{ form.membros.label }}</label>
      {{ form.membros|add_class:"form-select" }}
      {% if form.membros.errors %}<p class="mt-1 text-xs text-red-500">{{ form.membros.errors }}</p>{% endif %}
    </div>
    <div class="flex justify-end gap-3 pt-4 border-t border-neutral-100">
      <a href="{% url 'nucleos:list' %}" class="rounded-xl border border-neutral-300 px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">Cancelar</a>
      <button type="submit" class="rounded-xl bg-primary-600 px-4 py-2 text-sm text-white hover:bg-primary-700">Salvar</button>
    </div>
  </form>

  <div class="mt-8 rounded-2xl border border-neutral-200 bg-white">
    <div class="border-b border-neutral-200 px-6 py-4">
      <h2 class="text-xl font-semibold text-neutral-900">Membros</h2>
    </div>
    <div class="p-6">
      <div class="grid md:grid-cols-2 gap-6">
        {% for membro in membros %}
        <div class="rounded-xl border border-neutral-200 bg-white p-4 flex items-center gap-4">
          <div class="h-12 w-12 flex-shrink-0 rounded-full bg-neutral-100 flex items-center justify-center overflow-hidden">
            {% if membro.avatar %}
              <img src="{{ membro.avatar.url }}" alt="{{ membro.username }}" class="h-full w-full object-cover">
            {% else %}
              <span class="font-medium text-neutral-500">{{ membro.username|make_list|first|upper }}</span>
            {% endif %}
          </div>
          <div class="flex-1">
            <h4 class="font-semibold text-neutral-900">{{ membro.get_full_name|default:membro.username }}</h4>
            <p class="text-sm text-neutral-600">@{{ membro.username }}</p>
          </div>
          <form method="post" action="{% url 'nucleos:remove_member' object.id membro.id %}">
            {% csrf_token %}
            <button type="submit" class="rounded-xl bg-red-600 px-3 py-1 text-sm text-white hover:bg-red-700">Remover</button>
          </form>
        </div>
        {% empty %}
        <p>Nenhum membro neste núcleo.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
