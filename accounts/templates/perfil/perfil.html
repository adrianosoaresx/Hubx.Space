{% extends "base.html" %}
{% load static %}

{% block title %}Meu Perfil | Hubx{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'accounts/css/register.css' %}">
<link rel="stylesheet" href="{% static 'perfil/css/perfil.css' %}">
<link rel="stylesheet" href="{% static 'empresas/css/empresas.css' %}">
{% endblock %}

{% block content %}
<div class="perfil-container">
    <!-- Matrix Code Rain Effect -->
    <div class="matrix-code" id="matrixCode"></div>

    <!-- Molecular Network Background -->
    <div class="molecular-network">
        <div class="perfil-node" style="top: 15%; left: 8%;"></div>
        <div class="perfil-node" style="top: 25%; right: 12%;"></div>
        <div class="perfil-node" style="top: 45%; left: 5%;"></div>
        <div class="perfil-node" style="top: 65%; right: 8%;"></div>
        <div class="perfil-node" style="top: 80%; left: 15%;"></div>
    </div>

    <!-- Sidebar (now horizontal header) -->
    <div class="perfil-sidebar">
        <div class="perfil-header-top-section"> {# Contains avatar/info and dashboard button #}
            <div class="avatar-info-group"> {# Groups avatar, user info, and the separator line #}
                <div class="avatar-container">
                    <div class="avatar-wrapper">
                        {% if user.avatar %}
                            <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
                        {% else %}
                            <div class="avatar-placeholder">
                                <span>{{ user.username|make_list|first|upper }}</span>
                            </div>
                        {% endif %}
                        <button class="avatar-edit-btn" id="avatarEditBtn" title="Alterar foto">
                            <span>📷</span>
                        </button>
                    </div>
                    <div class="user-info">
                        <h2 class="user-name">{{ user.get_full_name }}</h2>
                        <p class="user-username">@{{ user.username }}</p>
                    </div>
                </div>
                <div class="perfil-separator-inline"></div> {# The horizontal line, visually aligned #}
            </div>
            <div class="top-right-buttons"> {# This div is now empty #}
            </div>
        </div>
        <nav class="sidebar-nav"> {# Main horizontal navigation #}
            <a href="{% url 'accounts:informacoes_pessoais' %}" class="nav-item">
                <span class="nav-icon">👤</span>
                <span class="nav-text">Informações Pessoais</span>
            </a>
            <a href="{% url 'accounts:contato' %}" class="nav-item">
                <span class="nav-icon">📞</span>
                <span class="nav-text">Contato</span>
            </a>
            <a href="{% url 'accounts:conexoes' %}" class="nav-item">
                <span class="nav-icon">🤝</span>
                <span class="nav-text">Conexões</span>
            </a>
        </nav>
        <div class="perfil-secondary-nav"> {# New section for Dashboard, Empresas, Nucleos, Eventos #}
            <a
                href="{% if user.tipo_id == 4 %}{% url 'dashboard:root' %}{% elif user.tipo_id == 1 %}{% url 'dashboard:admin' %}{% elif user.tipo_id == 2 %}{% url 'dashboard:gerente' %}{% else %}{% url 'dashboard:cliente' %}{% endif %}"
                class="btn-secondary-nav"
            >
                <span>🏠</span>
                <span>Dashboard</span>
            </a>
            {% if user.tipo_id == 4 %}
            <a href="{% url 'organizacoes:list' %}" class="btn-secondary-nav">
                <span>🏛️</span>
                <span>Organizações</span>
            </a>
            {% endif %}
            <a href="{% url 'empresas:lista' %}" class="btn-secondary-nav">
                <span>🏢</span>
                <span>Empresas</span>
            </a>
            <a href="{% url 'nucleos:list' %}" class="btn-secondary-nav">
                <span>⚛️</span>
                <span>Núcleos</span>
            </a>
            <a href="{% url 'eventos:list' %}" class="btn-secondary-nav">
                <span>🗓️</span>
                <span>Eventos</span>
            </a>
            {% if user.tipo_id == 4 %}
            <a href="{% url 'empresas:tags_list' %}" class="btn-secondary-nav">
                <span>🛒</span>
                <span>Produtos/Serviços</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Content area -->
    <div class="perfil-content">
        {# Cada subpágina injeta aqui o seu HTML #}
        {% block perfil_subpage_content %}{% endblock %}
    </div>

    <!-- New Profile Footer Navigation -->
    <div class="perfil-bottom-nav">
        <nav class="sidebar-nav">
            <a href="{% url 'accounts:redes_sociais' %}" class="nav-item">
                <span class="nav-icon">🌐</span>
                <span class="nav-text">Redes Sociais</span>
            </a>
            <a href="{% url 'accounts:notificacoes' %}" class="nav-item">
                <span class="nav-icon">🔔</span>
                <span class="nav-text">Notificações</span>
            </a>

            {# Removed "Minhas Empresas" from here #}
            <a href="{% url 'accounts:seguranca' %}" class="nav-item">
                <span class="nav-icon">🔒</span>
                <span class="nav-text">Segurança</span>
            </a>
        </nav>
    </div>

    <!-- Modal: Upload Avatar -->
    <div class="modal" id="avatarModal">
        <div class="modal-content">
            <form id="avatarForm" method="post" action="{% url 'accounts:perfil' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-header">
                    <h3>Alterar Foto de Perfil</h3>
                    <button class="modal-close" type="button">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="avatar-upload">
                        <div class="avatar-preview" id="avatarPreview">
                            {% if user.avatar %}
                                <img src="{{ user.avatar.url }}" alt="{{ user.username }}">
                            {% else %}
                                <div class="avatar-placeholder">
                                    <span>{{ user.username|make_list|first|upper }}</span>
                                </div>
                            {% endif %}
                        </div>

                        <div class="avatar-actions">
                            <label for="avatarInput" class="btn-upload">
                                Escolher Foto
                                <input type="file" id="avatarInput" name="avatar" accept="image/*" hidden>
                            </label>
                            <button type="button" class="btn-remove" id="removeAvatar">Remover Foto</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="cancelAvatar">Cancelar</button>
                    <button type="submit" class="btn-primary" id="saveAvatar">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Confirmação genérica -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">Confirmação</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Tem certeza que deseja realizar esta ação?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="cancelAction">Cancelar</button>
                <button type="button" class="btn-danger" id="confirmAction">Confirmar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'perfil/js/perfil.js' %}"></script>
{% endblock %}
